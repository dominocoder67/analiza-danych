---
title: "analiza danych - samochody"
author: "Dominik Bartosiak, Damian Damięcki, Mikołaj Kustusz"
date: "`r Sys.Date()`"
output:
  rmdformats::downcute:
    self_contained: true
    default_style: "light"
    downcute_theme: "default"
---

```{r setup, include=FALSE}
## Global options
knitr::opts_chunk$set(cache = TRUE)
if (!require(tidyverse)) install.packages("tidyverse")
if (!require(dplyr)) install.packages("dplyr")
if (!require(naniar)) install.packages("naniar")
if (!require(ggplot2)) install.packages("ggplot2")
if (!require(VIM)) install.packages("VIM")
if (!require(validate)) install.packages("validate")
if (!require(validatetools)) install.packages("validatetools")
if (!require(dcmodify)) install.packages("dcmodify")
if (!require(errorlocate)) install.packages("errorlocate")
if (!require(plotly)) install.packages("plotly")

library(tidyverse)
library(dplyr)
library(naniar)
library(ggplot2)
library(VIM)
library(validate)
library(validatetools)
library(dcmodify)
library(errorlocate)
library(plotly)

dane <- read_csv("dane/Car_Prices_Poland_Kaggle.csv")
```

# Wstęp

Celem niniejszego raportu jest analiza danych dotyczących cen samochodów w Polsce. Dane zostały pozyskane z platformy Kaggle i zawierają informacje na temat różnych modeli samochodów, ich cech oraz cen rynkowych. Analiza ma na celu zrozumienie czynników wpływających na ceny samochodów oraz identyfikację wzorców i trendów w danych.

## Opis danych

Zestaw danych pochodzi z jednego z największych portali ogłoszeniowych w Polsce. Zgromadzono w nim ponad 200 tysięcy ofert sprzedaży samochodów, obejmujących szeroki zakres marek, modeli, parametrów technicznych oraz informacji o stanie pojazdu.

Celem zbioru jest umożliwienie analizy cen, cech technicznych, profilu ofert i trendów rynkowych dotyczących samochodów używanych i nowych dostępnych na polskim rynku.

### Pytania badawcze

1.  **Jakie są średnie ceny samochodów w zależności od marki i modelu?**
2.  **Które cechy samochodów (np. rok produkcji, przebieg, moc silnika, rodzaj paliwa) mają największy wpływ na cenę pojazdu?**
3.  **Jak zmieniają się ceny samochodów w zależności od roku produkcji? Czy starsze samochody tanieją liniowo czy nieliniowo?**
4.  **Czy istnieją różnice w cenach samochodów w zależności od typu pojazdu (np. sedan, SUV, hatchback, kombi)?**
5.  **Jak przebieg pojazdu wpływa na jego cenę i czy wpływ ten różni się między markami?**
6.  **Czy rodzaj paliwa (benzyna, diesel, LPG, hybryda, elektryczny) wpływa na cenę?**

## Analiza danych

## 2.1 Braki danych

Usunięcie kolumny ..1, ponieważ nie wpływa ona na analizę.

```{r}
dane %>% select(-"...1")
```

```{r}
procent <- prop_complete_var(dane) * 100
```

W danych znajduje się `r procent` % kompletnych wartości.

```{r message=FALSE, warning=FALSE}
raport <- VIM::aggr(dane, col=c('navyblue','red'), numbers=TRUE, sortVars=TRUE, labels=names(dane), cex.axis=.7, gap=3, ylab=c("Procent braków danych","Wzorzec braków danych"))

raport$x
```

## Imputacje danych

```{r}
dane_imp <- hotdeck(dane)
VIM::aggr(dane_imp, col=c('navyblue','red'), numbers=TRUE, sortVars=TRUE, labels=names(dane_imp), cex.axis=.7, gap=3, ylab=c("Procent braków danych po imputacji","Wzorzec braków danych po imputacji"))
```

Po imputacji danych za pomocą metody hotdeck, wszystkie braki danych zostały uzupełnione.

## 2.2 Walidacja danych

## Reguły

Rozpatrzmy następujący zbiór danych. Co widzisz w początkowych wierszach?

```{r}
data(dane_imp)
head(dane_imp[3:7],3)
# dodajmy ID
dane_imp$rec_id <- sprintf("%03d",1:nrow(dane_imp))

rules <- validator(
  price >= 0
  , year > 0 & year < 2026
  , mileage >= 0
  , fuel %in% c("Diesel", "CNG", "Gasoline", "Hybrid", "Electric", "LPG")
)

cf <- confront(dane_imp, rules, key="rec_id")
summary(cf)
barplot(cf, main="Samochody - Walidacja danych")
#as.data.frame(cf) %>% head()
```

Wszystkie dane są poprawne zgodnie z ustalonymi regułami walidacji.
